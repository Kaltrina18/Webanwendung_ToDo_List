<!doctype html>
<html lang = "de">
<head>
<meta charset = "utf-8"/>
<title>Passwort vergessen</title>
<meta name = "viewport" content = "width=device-width,initial-scale=1"/>
<!-- CSS-Styles aus externer Datei laden -->
<link rel = "stylesheet" href = "style.css"/>
</head>
<body>

  <!-- Karte in der Mitte der Seite -->
  <div class = "card-centered">
    <!-- Logo -->
    <div class = "logo">CODIRE</div>
    <!-- Überschrift -->
    <h1>Passwort zurücksetzen</h1>
    <!-- Eingabefeld für E-Mail oder Telefonnummer -->
    <input id = "identifier" class = "input" placeholder = "E-Mail oder Telefonnummer"/>
    <!-- Button, um den Bestätigungscode anzufordern -->
    <button id = "btnRequest" class = "btn" type = "button">Code anfordern</button>
    <!-- Button, um zurück zur Login-Seite zu gehen -->
    <button id = "btnBack" class = "small-link" type = "button">Zurück</button>
    <!-- Hinweistext für den Benutzer -->
    <p style = "font-size:13px;color:#555;margin-top:8px">Gib deine E-Mail oder Telefonnummer ein. Du bekommst einen Bestätigungscode.</p>
  </div>

  <!-- JavaScript-Logik -->
<script>
  // API-Hilfsfunktion für Server-Requests
async function api(path, opts = {}) {
  opts.headers = opts.headers||{};
  if(opts.body && typeof opts.body === 'object'){ 
    opts.body = JSON.stringify(opts.body); 
    opts.headers['Content-Type'] = 'application/json'; }
  const res = await fetch(path, 
  {...opts, credentials:'include'}
);

  if (!res.ok) {
    try { 
      const e = await res.json(); 
      alert(e.error || 'Fehler'); 
    } catch(_) { 
      alert('Fehler'); 
      }
    throw 'err';
  }
  return res.json();
}

// Eventlistener für "Code anfordern"
document.getElementById('btnRequest').addEventListener('click', async () => {
  const id = document.getElementById('identifier').value.trim();
  if (!id) { 
    alert('Bitte eingeben'); 
    return; 
}

  try {
    // Anfrage an den Server schicken
    await api('/api/request-code', { 
      method: 'POST', 
      body: { identifier: id }
    });
    // Weiterleitung auf Verifikationsseite
    location.href = '/verify-set.html?identifier=' + encodeURIComponent(id) + '&purpose=reset';
  } catch(e) {}
});

// Eventlistener für "Zurück" → zurück zur Login-Seite
document.getElementById('btnBack').addEventListener('click', () => location.href = '/');
</script>
</body>
</html>
